---
import Header from "../components/header/Header.astro";
import Footer from "../components/Footer.astro";
import { getLangFromUrl } from "../i18n/utils";

// Détecter la langue depuis l'URL
const lang = getLangFromUrl(Astro.url);
---

<html lang={lang}>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <slot name="head" />
  </head>
  <body class="relative" data-cy="app-body">
    <!-- Grille de fond avec fondu -->
    <div class="grid-background" data-cy="grid-background"></div>
    <Header />
    <main data-cy="main-content">
      <slot />
    </main>
    <Footer />
  </body>
</html>

<style>
  .grid-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: -1;
    pointer-events: none;

    /* Grille optimisée avec data-URI statique */
    background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23000' stroke-width='0.02' opacity='0.008'%3E%3Cpath d='M0 0v24M24 0v24M0 0h24M0 24h24'/%3E%3C/g%3E%3C/svg%3E");
    background-size: 24px 24px;
    background-attachment: local;
    background-repeat: repeat;

    /* Effet de fondu ultra-doux vers le bas - optimisé */
    mask: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.05) 0%,
      rgba(0, 0, 0, 0.05) 10%,
      rgba(0, 0, 0, 0.05) 30%,
      rgba(0, 0, 0, 0.01) 60%,
      rgba(0, 0, 0, 0) 80%
    );
    -webkit-mask: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.05) 0%,
      rgba(0, 0, 0, 0.05) 10%,
      rgba(0, 0, 0, 0.05) 30%,
      rgba(0, 0, 0, 0.01) 60%,
      rgba(0, 0, 0, 0) 80%
    );
  }

  /* Adaptation pour les petits écrans */
  @media (max-width: 768px) {
    .grid-background {
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23000' stroke-width='0.015' opacity='0.005'%3E%3Cpath d='M0 0v20M20 0v20M0 0h20M0 20h20'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 20px 20px;
    }
  }

  /* Mode motion réduit - performance optimisée */
  @media (prefers-reduced-motion: reduce) {
    .grid-background {
      /* Désactiver complètement le background pour une performance maximale */
      display: none;
    }
  }

  /* Optimisation pour les appareils low-end */
  @media (max-width: 480px) and (max-height: 800px) {
    .grid-background {
      /* Grille encore plus discrète pour très petits écrans */
      background-image: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%23000' stroke-width='0.01' opacity='0.003'%3E%3Cpath d='M0 0v16M16 0v16M0 0h16M0 16h16'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 16px 16px;
      /* Simplifier le masque pour une meilleure performance */
      mask: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.03) 0%,
        rgba(0, 0, 0, 0) 70%
      );
      -webkit-mask: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.03) 0%,
        rgba(0, 0, 0, 0) 70%
      );
    }
  }
</style>
