---
// Header.astro
interface Props {
  logo?: string;
  siteName?: string;
}

const { logo = "/logo.svg", siteName = "Mon Site" } = Astro.props;

const navLinks = [
  { href: "/", label: "Accueil", labelEN: "Home" },
  { href: "/about", label: "Ã€ propos", labelEN: "About" },
  { href: "/services", label: "Services", labelEN: "Services" },
  { href: "/contact", label: "Contact", labelEN: "Contact" },
];
---

<header
  id="main-header"
  class="bg-base-100/95 border-base-300/20 fixed top-0 right-0 left-0 z-50 border-b backdrop-blur-sm transition-all duration-300"
>
  <div class="navbar mx-auto max-w-7xl px-4">
    <!-- Logo Ã  gauche -->
    <div class="navbar-start">
      <a href="/" class="btn btn-ghost text-xl font-bold">
        <img src={logo} alt={siteName} class="mr-2 h-8 w-8" />
        {siteName}
      </a>
    </div>

    <!-- Navigation principale (desktop) -->
    <div class="navbar-center hidden lg:flex">
      <ul class="menu menu-horizontal px-1">
        {
          navLinks.map((link) => (
            <li>
              <a
                href={link.href}
                class="nav-link hover:bg-primary hover:text-primary-content transition-colors duration-200"
                data-fr={link.label}
                data-en={link.labelEN}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>

    <!-- Droite : SÃ©lecteur langue et theme toggle -->
    <div class="navbar-end flex items-center gap-2">
      <!-- SÃ©lecteur de langue -->
      <div class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
          <span id="current-lang">FR</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="12"
            height="12"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M6 9l6 6 6-6"></path>
          </svg>
        </div>
        <ul
          tabindex="0"
          class="dropdown-content menu bg-base-100 rounded-box border-base-300 z-[1] w-24 border p-2 shadow-lg"
        >
          <li><a href="#" class="lang-option" data-lang="fr">ðŸ‡«ðŸ‡· FR</a></li>
          <li><a href="#" class="lang-option" data-lang="en">ðŸ‡ºðŸ‡¸ EN</a></li>
        </ul>
      </div>

      <!-- Theme Toggle -->
      <label class="flex cursor-pointer items-center gap-2">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="5"></circle>
          <path
            d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"
          ></path>
        </svg>
        <input
          type="checkbox"
          value="dark"
          class="toggle theme-controller"
          id="theme-toggle"
        />
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </label>

      <!-- Bouton hamburger (mobile) -->
      <label
        for="mobile-menu"
        class="btn btn-square btn-ghost swap swap-rotate lg:hidden"
      >
        <input type="checkbox" id="mobile-menu" class="hidden" />
        <!-- IcÃ´ne hamburger -->
        <svg
          class="swap-off h-6 w-6 fill-current"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        >
          <path
            d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"
          ></path>
        </svg>
        <!-- IcÃ´ne fermer -->
        <svg
          class="swap-on h-6 w-6 fill-current"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        >
          <polygon
            points="400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49"
          ></polygon>
        </svg>
      </label>
    </div>
  </div>
</header>

<!-- Menu mobile overlay -->
<div
  id="mobile-overlay"
  class="pointer-events-none fixed inset-0 z-40 bg-black/50 opacity-0 backdrop-blur-sm transition-opacity duration-300 lg:hidden"
>
  <div
    id="mobile-menu-content"
    class="bg-base-100 border-base-300 fixed top-0 right-0 h-full w-80 translate-x-full transform border-l transition-transform duration-300"
  >
    <!-- Header du menu mobile (mÃªme hauteur que le header principal) -->
    <div
      class="border-base-300 flex items-center justify-between border-b p-4"
      style="height: 64px;"
    >
      <div class="flex items-center">
        <img src={logo} alt={siteName} class="mr-2 h-6 w-6" />
        <span class="text-lg font-bold">{siteName}</span>
      </div>

      <!-- SÃ©lecteurs dans le header mobile -->
      <div class="flex items-center gap-2">
        <!-- SÃ©lecteur de langue mobile -->
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
            <span id="mobile-current-lang">FR</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="12"
              height="12"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M6 9l6 6 6-6"></path>
            </svg>
          </div>
          <ul
            tabindex="0"
            class="dropdown-content menu bg-base-100 rounded-box border-base-300 z-[1] w-24 border p-2 shadow-lg"
          >
            <li>
              <a href="#" class="mobile-lang-option" data-lang="fr">ðŸ‡«ðŸ‡· FR</a>
            </li>
            <li>
              <a href="#" class="mobile-lang-option" data-lang="en">ðŸ‡ºðŸ‡¸ EN</a>
            </li>
          </ul>
        </div>

        <!-- Theme Toggle mobile -->
        <label class="flex cursor-pointer items-center">
          <input
            type="checkbox"
            value="dark"
            class="toggle toggle-sm theme-controller"
            id="mobile-theme-toggle"
          />
        </label>
      </div>
    </div>

    <!-- Navigation mobile -->
    <nav class="p-4">
      <ul class="menu w-full">
        {
          navLinks.map((link) => (
            <li class="mb-2">
              <a
                href={link.href}
                class="mobile-nav-link hover:bg-primary hover:text-primary-content py-3 text-lg transition-colors duration-200"
                data-fr={link.label}
                data-en={link.labelEN}
              >
                {link.label}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>
</div>

<script>
  /**
   * Import et initialisation du HeaderManager
   * Toute la logique TypeScript a Ã©tÃ© extraite dans des modules sÃ©parÃ©s
   */
  import { initializeHeader } from "../scripts/header/index.js";

  // Le HeaderManager s'initialise automatiquement au chargement du DOM
  // via l'event listener dans index.ts

  // Si besoin d'accÃ©der programmatiquement aux gestionnaires :
  // import { getHeaderManager } from "../scripts/header/index.js";
  // const headerManager = getHeaderManager();
</script>

<style>
  /* Styles additionnels pour les transitions smooth */
  #mobile-menu-content {
    box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
  }

  /* Animation pour le header */
  #main-header {
    transition:
      background-color 0.3s ease,
      border-color 0.3s ease;
  }

  /* AmÃ©lioration du contraste pour les icÃ´nes */
  .navbar svg {
    opacity: 0.8;
    transition: opacity 0.2s ease;
  }

  .navbar svg:hover {
    opacity: 1;
  }

  /* Style pour le menu mobile */
  .mobile-nav-link {
    border-radius: 0.5rem;
  }

  /* AmÃ©lioration des dropdowns */
  .dropdown-content {
    animation: dropdown-appear 0.2s ease-out;
  }

  @keyframes dropdown-appear {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
